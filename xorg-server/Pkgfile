# Description: X Window System server
# URL: http://xorg.freedesktop.org
# Maintainer: Tilman Sauerbeck, tilman at crux dot nu
# Depends on: mesa3d, xorg-bdftopcf, xorg-mkfontdir, xorg-mkfontscale, xorg-xf86driproto, xorg-libxkbui, xorg-xcmiscproto, xorg-scrnsaverproto, xorg-bigreqsproto, xorg-libxevie, xorg-libxtst, xorg-libdmx, xorg-libxxf86misc, xorg-libxaw, xorg-libxvmc, xorg-libxi, xorg-libxres, xorg-libxcomposite, xorg-libxinerama, xorg-libxrandr, xorg-libxtrap, xorg-libxft, xorg-libxcursor, xorg-libxxf86dga, xorg-libpixman

name=xorg-server
version=1.4
release=6
source=(http://xorg.freedesktop.org/releases/individual/xserver/$name-$version.tar.bz2 \
        http://dl.sourceforge.net/mesa3d/MesaLib-7.0.2.tar.bz2 \
        ftp://ftp.freedesktop.org/pub/xorg/X11R7.3/patches/xorg-xserver-$version-multiple-overflows-v2.diff)

build() {
	cd $name-$version

	patch -Np1 -i $SRC/xorg-xserver-$version-multiple-overflows-v2.diff

	./configure --prefix=/usr --enable-dri \
	            --with-mesa-source=$SRC/Mesa-7.0.2 \
	            --localstatedir=/var --mandir=/usr/man \
	            --with-xkb-output=/var/lib/xkb

	make
	make DESTDIR=$PKG install

	rmdir $PKG/var/log
}
